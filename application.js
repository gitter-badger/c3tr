!function(e){function t(r){if(n[r])return n[r].exports;var u=n[r]={exports:{},id:r,loaded:!1};return e[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var u=n(1),a=r(u);window.addEventListener("load",a["default"].init)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(){var e=768,t=1024,n=j["default"].logTime("World generation",function(){return _["default"].generate(t,e)}),r=_["default"].startingPosition(n);return{state:{entities:_["default"].populate(n).concat(y["default"].create(r)),messages:[],worldHeight:e,worldWidth:t},world:n}}function a(){function e(){t&&window.cancelAnimationFrame(t),t=window.requestAnimationFrame(o.bind(null,n))}var t=null,n=u();window.addEventListener("keydown",function(t){var r=void 0;switch(t.keyCode){case 77:case 81:return l();case 73:return f();case 39:case 76:r=h["default"].MOVE_EAST;break;case 38:case 75:r=h["default"].MOVE_NORTH;break;case 85:r=h["default"].MOVE_NORTHEAST;break;case 89:r=h["default"].MOVE_NORTHWEST;break;case 40:case 74:r=h["default"].MOVE_SOUTH;break;case 78:r=h["default"].MOVE_SOUTHEAST;break;case 66:r=h["default"].MOVE_SOUTHWEST;break;case 37:case 72:r=h["default"].MOVE_WEST}Boolean(r)&&(n=s(r,n),e())}),window.addEventListener("resize",function(){c(window.innerWidth,window.innerHeight),e()}),c(window.innerWidth,window.innerHeight),j["default"].logTime("Initial render",function(){return o(n)})}function i(e){var t=M["default"].find("#Log"),n=M["default"].html("p",{},[e]);t.insertBefore(n,t.firstChild)}function o(e){(0,R["default"])(e),(0,k["default"])(e),(0,V["default"])(e),(0,W["default"])(e)}function c(e,t){var n=M["default"].find("#Field");n.setAttribute("width",e),n.setAttribute("height",t-80)}function f(){d(M["default"].find("#Inventory"))}function l(){d(M["default"].find("#Log"))}function d(e){e.classList.contains("open")?e.classList.remove("open"):e.classList.add("open")}function s(e,t){var n=t.state,r=n.entities,u=n.entities.find(function(e){return"CARL"===e.id}),a=void 0;switch(e){case h["default"].MOVE_EAST:a=T["default"].EAST;break;case h["default"].MOVE_NORTH:a=T["default"].NORTH;break;case h["default"].MOVE_NORTHEAST:a=T["default"].NORTHEAST;break;case h["default"].MOVE_NORTHWEST:a=T["default"].NORTHWEST;break;case h["default"].MOVE_SOUTH:a=T["default"].SOUTH;break;case h["default"].MOVE_SOUTHEAST:a=T["default"].SOUTHEAST;break;case h["default"].MOVE_SOUTHWEST:a=T["default"].SOUTHWEST;break;case h["default"].MOVE_WEST:a=T["default"].WEST}a&&(u=E["default"].attach(u,A["default"].create(a)),r=r.map(function(e){return"CARL"===e.id?u:e})),n=Object.assign({},t.state,{entities:r,messages:[]}),n=x["default"].run(Object.assign({},t,{state:n})),n.messages.forEach(function(e){return i(e)});var o={state:Object.assign({},t.state,n),world:t.world};return o}Object.defineProperty(t,"__esModule",{value:!0});var v=n(2),h=r(v),p=n(3),y=r(p),m=n(23),M=r(m),O=n(24),_=r(O),g=n(32),T=r(g),b=n(7),E=r(b),S=n(33),A=r(S),w=n(34),x=r(w),P=n(31),j=r(P),H=n(36),k=r(H),N=n(37),V=r(N),U=n(38),R=r(U),I=n(39),W=r(I);t["default"]={init:a}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=Object.freeze({MOVE_EAST:"MOVE_EAST",MOVE_NORTH:"MOVE_NORTH",MOVE_NORTHEAST:"MOVE_NORTHEAST",MOVE_NORTHWEST:"MOVE_NORTHWEST",MOVE_SOUTH:"MOVE_SOUTH",MOVE_SOUTHEAST:"MOVE_SOUTHEAST",MOVE_SOUTHWEST:"MOVE_SOUTHWEST",MOVE_WEST:"MOVE_WEST"})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return Boolean(e)?this.energy.current>=c(e):!1}function a(e){return O["default"].create(W,[d["default"].create("@","#f8f8f8",100),p["default"].create(v["default"].create(1)),m["default"].create(6e4),g["default"].create(100),b["default"].create("CARL"),S["default"].create(),w["default"].create(i),P["default"].create(u),H["default"].create("Carl"),N["default"].create(e.x,e.y),I["default"].create(f)])}function i(e){return m["default"].drain(this,c(e))}function o(e){return e.find(function(e){return"CARL"===e.id})}function c(e){return U["default"].isWater(e)?100:10}function f(e){return m["default"].fill(this,e.energy.current)}Object.defineProperty(t,"__esModule",{value:!0});var l=n(4),d=r(l),s=n(5),v=r(s),h=n(10),p=r(h),y=n(11),m=r(y),M=n(7),O=r(M),_=n(12),g=r(_),T=n(13),b=r(T),E=n(14),S=r(E),A=n(15),w=r(A),x=n(16),P=r(x),j=n(8),H=r(j),k=n(17),N=r(k),V=n(19),U=r(V),R=n(22),I=r(R),W="Carl";t["default"]={create:a,findIn:o,type:W}},function(e,t){"use strict";function n(e){var t=arguments.length<=1||void 0===arguments[1]?"#ccc":arguments[1],n=arguments.length<=2||void 0===arguments[2]?0:arguments[2];return{key:"avatar",value:{character:e,importance:n,style:t}}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create:n}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return d["default"].create(y,[o["default"].create("#","#CC6"),f["default"].create(e),v["default"].create("CPU")])}function a(){return u(p["default"]["float"](1,6).toFixed(1))}Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=r(i),c=n(6),f=r(c),l=n(7),d=r(l),s=n(8),v=r(s),h=n(9),p=r(h),y="CPU";t["default"]={create:u,generate:a,type:y}},function(e,t){"use strict";function n(e){return{key:"clockSpeed",value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create:n}},function(e,t){"use strict";function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return e.hasOwnProperty(t.key)?(console.error("The "+e.type+' entity already has a "'+t.key+'" property.'),e):Object.assign({},e,n({},t.key,t.value))}function u(e){var t=arguments.length<=1||void 0===arguments[1]?[]:arguments[1];return t.reduce(function(e,t){var r=t.key,u=t.value;return Object.assign({},e,n({},r,u))},{type:e})}function a(e,t){return e.hasOwnProperty(t)?Object.keys(e).filter(function(e){return e!==t}).reduce(function(t,r){return Object.assign({},t,n({},r,e[r]))},{}):(console.error("The "+e.type+' entity does not have a "'+t+'" property.'),e)}function i(e,t){return e.type===t.type}function o(e,t){var r=Object.keys(t).reduce(function(t,n){return e.hasOwnProperty(n)?t&&!0:(console.error("The "+e.type+' entity does not have a "'+n+'" property.'),!1)},!0);return r?Object.assign({},e,Object.keys(t).reduce(function(r,u){return Object.assign({},r,n({},u,t[u](e[u])))},{})):e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={attach:r,create:u,detach:a,is:i,update:o}},function(e,t){"use strict";function n(e){return{key:"name",value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create:n}},function(e,t){"use strict";function n(){return u(["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"])}function r(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?Number.MAX_VALUE:arguments[1];return Math.random()*(t-e)+e}function u(e){return Array.isArray(e)?e[a(0,e.length-1)]:e[u(Object.keys(e))]}function a(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],t=arguments.length<=1||void 0===arguments[1]?Number.MAX_VALUE:arguments[1];return Math.floor(Math.random()*(t-e+i)+e)}Object.defineProperty(t,"__esModule",{value:!0});var i=1-1e-16;t["default"]={character:n,"float":r,from:u,integer:a}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return{key:"cpuSlot",value:{cpu:e}}}function a(e){return f["default"].update(e,{cpuSlot:function(){return{cpu:null}}})}function i(e,t){return f["default"].update(e,{cpuSlot:function(){return{cpu:t}}})}function o(e){return null===e.cpuSlot.cpu}Object.defineProperty(t,"__esModule",{value:!0});var c=n(7),f=r(c);t["default"]={create:u,empty:a,insert:i,isEmpty:o}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return{key:"energy",value:{current:e,max:e}}}function a(e,t){return l["default"].update(e,{energy:function(e){return{current:Math.max(0,e.current-t),max:e.max}}})}function i(e,t){return l["default"].update(e,{energy:function(e){return{current:Math.min(e.max,e.current+t),max:e.max}}})}function o(e){return e.energy.current<=0}function c(e){return e.energy.current>=0}Object.defineProperty(t,"__esModule",{value:!0});var f=n(7),l=r(f);t["default"]={create:u,drain:a,fill:i,isDrained:o,isFull:c}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return{key:"health",value:{current:e,max:e}}}function a(e,t){return l["default"].update(e,{health:function(e){return{current:Math.min(e.max,e.current+t),max:e.max}}})}function i(e,t){return l["default"].update(e,{health:function(e){return{current:Math.max(0,e.current-t),max:e.max}}})}function o(e){return e.health>0}function c(e){return!o(e)}Object.defineProperty(t,"__esModule",{value:!0});var f=n(7),l=r(f);t["default"]={create:u,heal:a,hit:i,isAlive:o,isDead:c}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return{key:"id",value:e}}function a(){return u(""+Date.now()+o["default"].integer(0,999))}Object.defineProperty(t,"__esModule",{value:!0});var i=n(9),o=r(i);t["default"]={create:u,generate:a}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){return l["default"].update(e,{inventory:function(e){return e.concat(t)}})}function a(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0];return{key:"inventory",value:e}}function i(e){return l["default"].update(e,{inventory:function(){return[]}})}function o(e){return 0===e.inventory.length}function c(e,t){return l["default"].update(e,{inventory:function(e){return e.filter(function(e){return e!==t})}})}Object.defineProperty(t,"__esModule",{value:!0});var f=n(7),l=r(f);t["default"]={addItem:u,create:a,empty:i,isEmpty:o,removeItem:c}},function(e,t){"use strict";function n(e){return{key:"moveAction",value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create:n}},function(e,t){"use strict";function n(e){return{key:"moveRestriction",value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create:n}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){return{key:"position",value:{x:e,y:t}}}function a(e,t){return e.x===t.x&&e.y===t.y}function i(e,t){var n=t.x,r=t.y;return f["default"].update(e,{position:function(){return{x:n,y:r}}})}function o(e,t){var n=d["default"][t];return{x:e.x+n.x,y:e.y+n.y}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(7),f=r(c),l=n(18),d=r(l);t["default"]={create:u,match:a,set:i,to:o}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=Object.freeze({EAST:{x:1,y:0},NORTH:{x:0,y:-1},NORTHEAST:{x:1,y:-1},NORTHWEST:{x:-1,y:-1},SOUTH:{x:0,y:1},SOUTHEAST:{x:1,y:1},SOUTHWEST:{x:-1,y:1},WEST:{x:-1,y:0}})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return e}function i(e,t,n){for(var r=new Array(e),u=0;e>u;u++){r[u]=new Array(t);for(var i=0;t>i;i++)r[u][i]=a(n(u,i))}return r}function o(e){return e===O["default"].CAVE}function c(e){return e===O["default"].LAND}function f(e){return e===O["default"].MOUNTAIN}function l(e){return e!==O["default"].MOUNTAIN}function d(e){return e===O["default"].WATER}function s(e){return _[e]}Object.defineProperty(t,"__esModule",{value:!0});var v,h=n(4),p=r(h),y=n(20),m=r(y),M=n(21),O=r(M),_=Object.assign((v={},u(v,O["default"].CAVE,{avatar:p["default"].create(".","#753").value,backgroundColor:m["default"].create("#642").value}),u(v,O["default"].LAND,{avatar:p["default"].create(".","#351").value,backgroundColor:m["default"].create("#240").value}),u(v,O["default"].MOUNTAIN,{avatar:p["default"].create("X","#555").value,backgroundColor:m["default"].create("#444").value}),u(v,O["default"].WATER,{avatar:p["default"].create("~","#357").value,backgroundColor:m["default"].create("#246").value}),v));t["default"]={create:a,generateGrid:i,isCave:o,isLand:c,isMountain:f,isPassable:l,isWater:d,value:s}},function(e,t){"use strict";function n(e){return{key:"backgroundColor",value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create:n}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=Object.freeze({CAVE:"cave",LAND:"land",MOUNTAIN:"mountain",WATER:"water"})},function(e,t){"use strict";function n(e){return{key:"suckle",value:e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={create:n}},function(e,t){"use strict";function n(e){var t=arguments.length<=1||void 0===arguments[1]?document:arguments[1];return t.querySelector(e)}function r(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];("object"!==("undefined"==typeof t?"undefined":a(t))||Array.isArray(t))&&(n=t,t={}),Array.isArray(n)||(n=[n]);var r=e.match(/\.[a-z\-]*/g);r&&(t["class"]=r.map(function(e){return e.slice(1)}).join(" "));var i=e.match(/#[A-Za-z]*/g);i&&(t.id=i[0].slice(1));var o=document.createElement(e.match(/^[a-z]*/g));return Object.keys(t).forEach(function(e){o.setAttribute(e,t[e])}),n.map(function(e){return"number"==typeof e||"string"==typeof e?u(e):e}).forEach(function(e){return o.appendChild(e)}),o}function u(e){return document.createTextNode(e)}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t["default"]={find:n,html:r,text:u}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){var n=new l["default"]({frequency:.05,octaves:6}),r=new l["default"]({frequency:.01,octaves:12}),u=new l["default"]({frequency:.008,octaves:8}),a=function(t,r){return Math.abs(n.cylindrical2D(e,t,r))},i=function(t,n){return r.cylindrical2D(e,t,n)},o=function(t,n){return u.cylindrical2D(e,t,n)},c=y["default"].generateGrid(e,t,function(e,t){var n=o(e,t);return n>.15?n>.3&&i(e,t)>.3?a(e,t)<.08?M["default"].CAVE:M["default"].MOUNTAIN:M["default"].LAND:M["default"].WATER});return{height:t,tiles:c,width:e}}function a(e){var t=arguments.length<=1||void 0===arguments[1]?5e3:arguments[1],n=[{type:s["default"],weight:3},{type:c["default"],weight:1}],r=void 0,u=[],a=void 0,i=[];n.forEach(function(e){for(var t=0;t<e.weight;t++)i=[].concat.call(i,e.type)});for(var o=0;t>o;o++)switch(r=_["default"].randomLandPosition(e),a=h["default"].from(i)){case s["default"]:u=u.concat(s["default"].create(r));break;case c["default"]:u=u.concat(c["default"].generate(r))}return u}function i(e){return _["default"].randomLandPosition(e)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(25),c=r(o),f=n(26),l=r(f),d=n(27),s=r(d),v=n(9),h=r(v),p=n(19),y=r(p),m=n(21),M=r(m),O=n(30),_=r(O);t["default"]={generate:u,populate:a,startingPosition:i}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1],n=[o["default"].create("%","#E6E69C"),f["default"].create(e),v["default"].create("battery")];return t&&n.push(p["default"].create(t.x,t.y)),d["default"].create(M,n)}function a(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];return u(m["default"].integer(600,1800),e)}Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),o=r(i),c=n(11),f=r(c),l=n(7),d=r(l),s=n(8),v=r(s),h=n(17),p=r(h),y=n(9),m=r(y),M="Battery";t["default"]={create:u,generate:a,type:M}},function(e,t){function n(e){if(e||(e={}),this.amplitude=e.amplitude||1,this.frequency=e.frequency||1,this.octaves=parseInt(e.octaves||1),this.persistence=e.persistence||.5,this.random=e.random||Math.random,"number"==typeof e.min&&"number"==typeof e.max)if(e.min>=e.max)console.error("options.min must be less than options.max");else{var t=parseFloat(e.min),n=parseFloat(e.max),r=n-t;this.scale=function(e){return t+(e+1)/2*r}}var u,a=new Uint8Array(256);for(u=0;256>u;u++)a[u]=u;var i,o;for(u=255;u>0;u--)i=Math.floor((u+1)*this.random()),o=a[u],a[u]=a[i],a[i]=o;for(this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512),u=0;512>u;u++)this.perm[u]=a[255&u],this.permMod12[u]=this.perm[u]%12}function r(e,t,n){return e[0]*t+e[1]*n}function u(e,t,n,r){return e[0]*t+e[1]*n+e[2]*r}function a(e,t,n,r,u){return e[0]*t+e[1]*n+e[2]*r+e[3]*u}var i=(3-Math.sqrt(3))/6,o=1/6,c=(5-Math.sqrt(5))/20,f=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,-1],[0,1,-1],[0,-1,-1]],l=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]];e.exports=n,n.prototype.cylindrical2D=function(e,t,n){var r=t/e,u=e/(2*Math.PI),a=2*r*Math.PI,i=u*Math.sin(a),o=u*Math.cos(a);return this.in3D(i,o,n)},n.prototype.cylindrical3D=function(e,t,n,r){var u=t/e,a=e/(2*Math.PI),i=2*u*Math.PI,o=a*Math.sin(i),c=a*Math.cos(i);return this.in4D(o,c,n,r)},n.prototype.in2D=function(e,t){for(var n=this.amplitude,r=this.frequency,u=0,a=0,i=this.persistence,o=0;o<this.octaves;o++)a+=this.raw2D(e*r,t*r)*n,u+=n,n*=i,r*=2;var c=a/u;return this.scale?this.scale(c):c},n.prototype.in3D=function(e,t,n){for(var r=this.amplitude,u=this.frequency,a=0,i=0,o=this.persistence,c=0;c<this.octaves;c++)i+=this.raw3D(e*u,t*u,n*u)*r,a+=r,r*=o,u*=2;var f=i/a;return this.scale?this.scale(f):f},n.prototype.in4D=function(e,t,n,r){for(var u=this.amplitude,a=this.frequency,i=0,o=0,c=this.persistence,f=0;f<this.octaves;f++)o+=this.raw4D(e*a,t*a,n*a,r*a)*u,i+=u,u*=c,a*=2;var l=o/i;return this.scale?this.scale(l):l},n.prototype.raw2D=function(e,t){var n,u,a,o,c,l=this.perm,d=this.permMod12,s=.5*(e+t)*(Math.sqrt(3)-1),v=Math.floor(e+s),h=Math.floor(t+s),p=(v+h)*i,y=v-p,m=h-p,M=e-y,O=t-m;M>O?(o=1,c=0):(o=0,c=1);var _=M-o+i,g=O-c+i,T=M-1+2*i,b=O-1+2*i,E=255&v,S=255&h,A=d[E+l[S]],w=d[E+o+l[S+c]],x=d[E+1+l[S+1]],P=.5-M*M-O*O;0>P?n=0:(P*=P,n=P*P*r(f[A],M,O));var j=.5-_*_-g*g;0>j?u=0:(j*=j,u=j*j*r(f[w],_,g));var H=.5-T*T-b*b;return 0>H?a=0:(H*=H,a=H*H*r(f[x],T,b)),70.14805770653952*(n+u+a)},n.prototype.raw3D=function(e,t,n){var r,a,i,c,l,d,s,v,h,p,y=this.perm,m=this.permMod12,M=(e+t+n)/3,O=Math.floor(e+M),_=Math.floor(t+M),g=Math.floor(n+M),T=(O+_+g)*o,b=O-T,E=_-T,S=g-T,A=e-b,w=t-E,x=n-S;A>=w?w>=x?(l=1,d=0,s=0,v=1,h=1,p=0):A>=x?(l=1,d=0,s=0,v=1,h=0,p=1):(l=0,d=0,s=1,v=1,h=0,p=1):x>w?(l=0,d=0,s=1,v=0,h=1,p=1):x>A?(l=0,d=1,s=0,v=0,h=1,p=1):(l=0,d=1,s=0,v=1,h=1,p=0);var P=A-l+o,j=w-d+o,H=x-s+o,k=A-v+2*o,N=w-h+2*o,V=x-p+2*o,U=A-1+3*o,R=w-1+3*o,I=x-1+3*o,W=255&O,C=255&_,D=255&g,L=m[W+y[C+y[D]]],q=m[W+l+y[C+d+y[D+s]]],z=m[W+v+y[C+h+y[D+p]]],F=m[W+1+y[C+1+y[D+1]]],B=.5-A*A-w*w-x*x;0>B?r=0:(B*=B,r=B*B*u(f[L],A,w,x));var G=.5-P*P-j*j-H*H;0>G?a=0:(G*=G,a=G*G*u(f[q],P,j,H));var X=.5-k*k-N*N-V*V;0>X?i=0:(X*=X,i=X*X*u(f[z],k,N,V));var J=.5-U*U-R*R-I*I;return 0>J?c=0:(J*=J,c=J*J*u(f[F],U,R,I)),94.68493150681971*(r+a+i+c)},n.prototype.raw4D=function(e,t,n,r){var u,i,o,f,d,s=this.perm,v=(this.permMod12,(e+t+n+r)*(Math.sqrt(5)-1)/4),h=Math.floor(e+v),p=Math.floor(t+v),y=Math.floor(n+v),m=Math.floor(r+v),M=(h+p+y+m)*c,O=h-M,_=p-M,g=y-M,T=m-M,b=e-O,E=t-_,S=n-g,A=r-T,w=0,x=0,P=0,j=0;b>E?w++:x++,b>S?w++:P++,b>A?w++:j++,E>S?x++:P++,E>A?x++:j++,S>A?P++:j++;var H,k,N,V,U,R,I,W,C,D,L,q;H=w>=3?1:0,k=x>=3?1:0,N=P>=3?1:0,V=j>=3?1:0,U=w>=2?1:0,R=x>=2?1:0,I=P>=2?1:0,W=j>=2?1:0,C=w>=1?1:0,D=x>=1?1:0,L=P>=1?1:0,q=j>=1?1:0;var z=b-H+c,F=E-k+c,B=S-N+c,G=A-V+c,X=b-U+2*c,J=E-R+2*c,Y=S-I+2*c,Z=A-W+2*c,K=b-C+3*c,Q=E-D+3*c,$=S-L+3*c,ee=A-q+3*c,te=b-1+4*c,ne=E-1+4*c,re=S-1+4*c,ue=A-1+4*c,ae=255&h,ie=255&p,oe=255&y,ce=255&m,fe=s[ae+s[ie+s[oe+s[ce]]]]%32,le=s[ae+H+s[ie+k+s[oe+N+s[ce+V]]]]%32,de=s[ae+U+s[ie+R+s[oe+I+s[ce+W]]]]%32,se=s[ae+C+s[ie+D+s[oe+L+s[ce+q]]]]%32,ve=s[ae+1+s[ie+1+s[oe+1+s[ce+1]]]]%32,he=.5-b*b-E*E-S*S-A*A;0>he?u=0:(he*=he,u=he*he*a(l[fe],b,E,S,A));var pe=.5-z*z-F*F-B*B-G*G;0>pe?i=0:(pe*=pe,i=pe*pe*a(l[le],z,F,B,G));var ye=.5-X*X-J*J-Y*Y-Z*Z;0>ye?o=0:(ye*=ye,o=ye*ye*a(l[de],X,J,Y,Z));var me=.5-K*K-Q*Q-$*$-ee*ee;0>me?f=0:(me*=me,f=me*me*a(l[se],K,Q,$,ee));var Me=.5-te*te-ne*ne-re*re-ue*ue;return 0>Me?d=0:(Me*=Me,d=Me*Me*a(l[ve],te,ne,re,ue)),72.37855765153664*(u+i+o+f+d)},n.prototype.spherical2D=function(e,t,n){var r=t/e,u=n/e,a=2*r*Math.PI,i=u*Math.PI,o=Math.sin(i+Math.PI),c=2*Math.PI,f=c*Math.sin(a)*o,l=c*Math.cos(a)*o,d=c*Math.cos(i);return this.in3D(f,l,d)},n.prototype.spherical3D=function(e,t,n,r){var u=t/e,a=n/e,i=2*u*Math.PI,o=a*Math.PI,c=Math.sin(o+Math.PI),f=2*Math.PI,l=f*Math.sin(i)*c,d=f*Math.cos(i)*c,s=f*Math.cos(o);return this.in4D(l,d,s,r)}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return c["default"].create(g,[i["default"].create("m","#e86b6b"),l["default"].create(100),s["default"].create([]),h["default"].create(y["default"].HOSTILE),M["default"].create("monster"),_["default"].create(e.x,e.y)])}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),i=r(a),o=n(7),c=r(o),f=n(12),l=r(f),d=n(14),s=r(d),v=n(28),h=r(v),p=n(29),y=r(p),m=n(8),M=r(m),O=n(17),_=r(O),g="Monster";t["default"]={create:u,type:g}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(){var e=arguments.length<=0||void 0===arguments[0]?i["default"].PASSIVE:arguments[0];return{key:"logic",value:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(29),i=r(a);t["default"]={create:u}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=Object.freeze({HOSTILE:"HOSTILE",PASSIVE:"PASSIVE"})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t,n){var r=f["default"].to(t,n);return r.x=p["default"].constrain(r.x,0,e.width),r}function a(e){var t=d["default"].integer(0,e.width-1),n=d["default"].integer(0,e.height-1),r=e.tiles[t][n];return v["default"].isLand(r)?{x:t,y:n}:a(e)}function i(e,t){var n=t.x,r=t.y;return 0>n||n>=e.width||0>r||r>=e.height?null:e.tiles[n][r]}function o(e,t,n){return i(e,u(e,t,n))}Object.defineProperty(t,"__esModule",{value:!0});var c=n(17),f=r(c),l=n(9),d=r(l),s=n(19),v=r(s),h=n(31),p=r(h);t["default"]={positionTo:u,randomLandPosition:a,tileAt:i,tileTo:o}},function(e,t){"use strict";function n(e,t,r){if(t>=r)throw new Error("`min` must be less than `max`");for(var u=r-t;t>e;)return n(e+u,t,r);for(;e>=r;)return n(e-u,t,r);return e}function r(e,t,n){var r=Date.now(),u=t(),a=Date.now(),i=a-r,o=n?" "+n(i):"";return console.log(e+" took",i,"ms"+o),u}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={constrain:n,logTime:r}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=Object.freeze({EAST:"EAST",NORTH:"NORTH",NORTHEAST:"NORTHEAST",NORTHWEST:"NORTHWEST",SOUTH:"SOUTH",SOUTHEAST:"SOUTHEAST",SOUTHWEST:"SOUTHWEST",WEST:"WEST"})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){return{key:"move",value:e}}function a(e){var t=f["default"][e.move],n={x:e.position.x+t.x,y:e.position.y+t.y};return n&&(e=d["default"].set(e,n)),o["default"].detach(e,"move")}Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),o=r(i),c=n(18),f=r(c),l=n(17),d=r(l);t["default"]={create:u,perform:a}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){var t=[],n=[],r=e.world,u=e.state.entities.map(function(u){if(!u.move||!u.position)return u;var a=M["default"].positionTo(r,u.position,u.move),o=M["default"].tileAt(r,a);return null===o||!y["default"].isPassable(o)||u.moveRestriction&&!u.moveRestriction(o)?l["default"].detach(u,"move"):(l["default"].is(u,c["default"])&&s["default"].entitiesAt(e,a).filter(function(e){return e.hasOwnProperty("name")}).forEach(function(e){t.push("You encounter a "+e.name+".")}),u.moveAction&&(u=u.moveAction(o)),u=l["default"].update(u,{position:function(){return a}}),u=l["default"].detach(u,"move"),u.suckle&&s["default"].entitiesAt(e,u.position).filter(function(e){return l["default"].is(e,i["default"])}).forEach(function(e){u=u.suckle(e),n.push(e)}),u)}).filter(function(e){return!n.includes(e)});return Object.assign({},e.state,{entities:u,messages:e.state.messages.concat(t)})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(25),i=r(a),o=n(3),c=r(o),f=n(7),l=r(f),d=n(35),s=r(d),v=n(33),h=(r(v),n(17)),p=(r(h),n(19)),y=r(p),m=n(30),M=r(m);t["default"]={run:u}},function(e,t){"use strict";function n(e,t){return e.state.entities.filter(function(e){return e.hasOwnProperty("position")}).filter(function(e){return e.position.x===t.x&&e.position.y===t.y})}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={entitiesAt:n}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e,t,n){return e.filter(function(e){return e.avatar&&e.position}).filter(function(e){var r=e.position,u=r.x,a=r.y;return(u>=t.x||u<=n.x)&&a>=t.y&&a<=n.y})}function a(e){var t=e.state,n=e.world,r=f["default"].find("#Field"),a=r.getContext("2d");a.clearRect(0,0,r.width,r.height),a.font="20px monospace";for(var i=o["default"].findIn(t.entities),c=i.position,l=r.width%20,s=r.height%20,h=l>0?l-20:0,y=s>0?s-20:0,m=Math.floor(r.width/20),M=Math.floor(r.height/20),O=Math.ceil(m/2),_=Math.ceil(M/2),g=c.x-O,T={x:0>g?g+n.width:g,y:c.y-_},b=g+m,E={x:b>n.width?b-n.width:b,y:T.y+M},S=u(t.entities,T,E),A=void 0,w=void 0,x=void 0,P=void 0,j=void 0,H=void 0,k=void 0,N=void 0,V=0;m>=V;V++)for(var U=0;M>=U;U++)k=c.x+V-O,N=c.y+U-_,w=20*V+h,x=20*U+y,0>N||N>=n.height||(0>k&&(k+=n.width),k>=n.width&&(k-=n.width),j=p["default"].tileAt(n,{x:k,y:N}),H=v["default"].value(j),a.fillStyle=H.backgroundColor,a.fillRect(w,x,20,20),P=S.filter(function(e){return d["default"].match(e.position,{x:k,y:N})}),A=P.length>0?P.reduce(function(e,t){return t.avatar.importance>e.avatar.importance?t:e}).avatar:H.avatar,a.fillStyle=A.style,a.fillText(A.character,w+4,x+16))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var i=n(3),o=r(i),c=n(23),f=r(c),l=n(17),d=r(l),s=n(19),v=r(s),h=n(30),p=r(h)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){var t=e.state,n=i["default"].findIn(t.entities).inventory.map(function(e){return c["default"].html("p",e.name)}),r=c["default"].html("div#Inventory",n);document.body.replaceChild(r,c["default"].find("#Inventory"))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=u;var a=n(3),i=r(a),o=n(23),c=r(o)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){var t=e.state.messages,n=i["default"].html("div",{id:"Message"},[t.length>0?t[t.length-1]:i["default"].html("p",{})]);document.body.replaceChild(n,i["default"].find("#Message"))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=u;var a=n(23),i=r(a)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function u(e){var t=e.state,n=e.world,r=i["default"].findIn(t.entities),u=c["default"].html("span.energy"),a=100*r.energy.current/r.energy.max;u.style.width=a+"%",20>a?u.classList.add("-critical"):50>a&&u.classList.add("-low");var o=c["default"].html("div#Status",[c["default"].html("section.-left",[h(["HP",v(":"),r.health.current,v("/"),r.health.max]),h(["CPU",v(":"),r.cpuSlot.cpu.clockSpeed.toFixed(1),p("GHz")])]),c["default"].html("section.-center",["("+(r.position.x+1)+", "+(r.position.y+1)+") ",v(l["default"].capitalize(s["default"].tileAt(n,r.position)))]),c["default"].html("section.-right",[h([l["default"].formatNumber(r.energy.current),p("J")]),c["default"].html("span.energy-bar",[u])])]);document.body.replaceChild(o,c["default"].find("#Status"))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=u;var a=n(3),i=r(a),o=n(23),c=r(o),f=n(40),l=r(f),d=n(30),s=r(d),v=function(e){return c["default"].html("span.sep",[c["default"].text(e)])},h=function(e){return c["default"].html("span.stat",e)},p=function(e){return c["default"].html("span.unit",[c["default"].text(e)])}},function(e,t){"use strict";function n(e){return!e.hasOwnProperty("length")||e.length<1?"":e.slice(0,1).toUpperCase()+e.slice(1)}function r(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={capitalize:n,formatNumber:r}}]);